# betagouv-ai-cli

> CLI to manage multi-tool AI configuration for beta.gouv.fr projects

## 🎯 Why this CLI?

Beta.gouv.fr teams use different AI assistance tools (Claude Code, Cursor, GitHub Copilot). Each tool has its own configuration format, creating duplication and synchronization problems.

This CLI provides a **unified architecture** where:
- ✅ A single `.ai/` folder contains all directives
- ✅ Configurations are modular and maintainable
- ✅ All AI tools use the same foundation
- ✅ The team stays synchronized via git

## 📦 Installation

```bash
# One-command installation (no dependencies required)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/betagouv/ai-cli/main/install.sh)"
```

## 🚀 Quick Start

### New project

```bash
# In your project
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/betagouv/ai-cli/main/install.sh)"

# Answer the questions:
# - Project name
# - Description
# - Primary framework/language
# - AI tools to install (Claude Code, Cursor, Windsurf, Copilot)

# The .ai/ structure is automatically created and synchronized

# Commit
git add .ai/
git commit -m "feat: add AI configuration"
```

### Existing project with AI configs

```bash
# Manually migrate your existing files to .ai/
# then synchronize
bash templates/ides/<tool>/init.sh

# Verify migrated files
ls -la .ai/
```

## 📁 Architecture

```
project/
├── .ai/                          # 🎯 SOURCE OF TRUTH (commit this)
│   ├── AGENTS.md                 # Main config file (references other files)
│   │
│   ├── context/                  # 📚 Project knowledge base
│   │   ├── overview.md           # Project overview, tech stack
│   │   ├── architecture.md       # Architecture decisions
│   │   ├── testing.md            # Testing guidelines
│   │   ├── security.md           # Security best practices
│   │   ├── workflows.md          # Development workflows
│   │   └── standards/
│   │       └── common.md         # Standards common to all languages
│   │
│   ├── commands/                 # Common commands (all IDEs)
│   ├── agents/                   # Common agents
│   └── avatars/                  # AI behavior profiles
│
├── languages/                    # 🗂️ Language-specific configs (commit this)
│   ├── typescript/
│   │   ├── AGENTS.md             # TypeScript-specific guidelines
│   │   ├── standards.md          # TypeScript standards
│   │   ├── commands/             # TS-specific commands
│   │   └── init.sh               # Setup script
│   ├── python/
│   │   ├── AGENTS.md
│   │   ├── standards.md
│   │   ├── commands/
│   │   └── init.sh
│   └── go/
│       ├── AGENTS.md
│       └── init.sh
│
├── templates/                    # 🔧 IDE setup scripts (downloaded during install)
│   └── ides/
│       ├── claude/init.sh        # Setup Claude Code
│       ├── cursor/init.sh        # Setup Cursor
│       ├── windsurf/init.sh      # Setup Windsurf
│       └── copilot/init.sh       # Setup GitHub Copilot
│
# ⬇️ GENERATED FILES (gitignored, created by init.sh):
│
├── .claude/                      # ← Generated by claude/init.sh
│   ├── CLAUDE.md                 # Symlink to .ai/AGENTS.md
│   ├── commands/                 # Symlink to .ai/commands/
│   ├── agents/                   # Symlink to .ai/agents/
│   └── avatars/                  # Symlink to .ai/avatars/
│
├── .cursor/
│   └── rules/
│       ├── main.mdc              # ← Symlink to .ai/AGENTS.md
│       ├── context/              # ← Symlink to .ai/context/
│       └── languages/            # ← Symlink to languages/
│
├── .windsurf/
│   └── rules/
│       ├── main.md               # ← Symlink to .ai/AGENTS.md
│       ├── context/              # ← Symlink to .ai/context/
│       └── languages/            # ← Symlink to languages/
│
└── .github/
    ├── copilot-instructions.md   # ← Symlink to .ai/AGENTS.md
    └── copilot/
        ├── context/              # ← Symlink to .ai/context/
        └── languages/            # ← Symlink to languages/
```

### Principle

1. **Edit** files in `.ai/` (source of truth)
2. **Run** `bash templates/ides/<tool>/init.sh` to regenerate a tool's config
3. **Commit** only the `.ai/` folder
4. **Your AI tool** automatically loads the config (via symlinks or generated files)

## 🛠️ init.sh Scripts per IDE

Each IDE has its own initialization script in `templates/ides/<tool>/init.sh`:

### Claude Code

```bash
bash templates/ides/claude/init.sh
```

**What it does:**
- Symlink `.claude/CLAUDE.md` → `.ai/AGENTS.md`
- Symlink `.claude/commands/` → `.ai/commands/` (entire folder)
- Symlink `.claude/agents/` → `.ai/agents/` (entire folder)
- Symlink `.claude/avatars/` → `.ai/avatars/` (entire folder)

✅ **Dynamic**: Add a file to `.ai/commands/` and it appears automatically in Claude Code!

### Cursor

```bash
bash templates/ides/cursor/init.sh
```

**Ce qu'il fait :**
- Génère `.cursor/rules/main.mdc` en fusionnant :
  - `.ai/AGENTS.md`
  - `.ai/context/*.md`
  - `languages/*/standards.md`

### Windsurf

```bash
bash templates/ides/windsurf/init.sh
```

**Ce qu'il fait :**
- Génère `.windsurfrules` en fusionnant tous les contextes

### GitHub Copilot

```bash
bash templates/ides/copilot/init.sh
```

**Ce qu'il fait :**
- Génère `.github/copilot-instructions.md` avec tous les contextes

## 📝 Utilisation au quotidien

### Modifier les directives

```bash
# 1. Éditer les fichiers sources
code .ai/context/standards/typescript.md

# 2. Pas besoin de sync si vous utilisez Claude (symlinks)
# Pour Cursor/Windsurf/Copilot, régénérer :
bash templates/ides/cursor/init.sh

# 3. Committer uniquement .ai/
git add .ai/
git commit -m "docs: update TypeScript standards"

# 4. L'équipe récupère et régénère
git pull
bash templates/ides/cursor/init.sh  # Si nécessaire
```

### Ajouter une commande Claude Code

```bash
# 1. Créer le fichier
echo "---
commandName: deploy
---

Deploy application...
" > .ai/commands/deploy.md

# 2. Déjà disponible ! (symlink automatique)

# 3. Utiliser
claude
/deploy
```

### Ajouter une commande spécifique TypeScript

```bash
# 1. Créer dans languages/typescript/commands/
echo "---
commandName: ts-build
---

Build TypeScript project...
" > languages/typescript/commands/build.md

# 2. Accessible via .claude/commands/languages/typescript/commands/build.md
claude
/ts-build
```

### Directives spécifiques à un module

Dans le README.md du module :

```markdown
# Module Auth

## Vue d'ensemble
...

## Directives IA

Lors du travail dans ce module :
- Utiliser JWT pour l'authentification
- Valider toutes les entrées avec Zod
- Ne jamais logger de données sensibles
```

## 🔧 Configuration

### Templates

Le CLI inclut des templates français optimisés pour beta.gouv.fr :

- **overview.md** - Vue d'ensemble du projet
- **architecture.md** - Décisions d'architecture
- **coding-standards.md** - Standards de code
- **testing.md** - Stratégie de test
- **security.md** - Sécurité (RGPD, best practices)
- **workflows.md** - Workflows de développement

### Personnalisation

Après `init`, customisez les fichiers dans `.ai/` pour votre projet :

```bash
# Adapter pour votre stack
code .ai/overview.md

# Définir vos conventions
code .ai/coding-standards.md

# Documenter votre architecture
code .ai/architecture.md
```

## 🤝 Outils supportés

| Outil | Support | Config générée |
|-------|---------|----------------|
| **Claude Code** | ✅ Full | `.claude/CLAUDE.md` + symlinks |
| **Cursor** | ✅ Full | `.cursor/rules/main.mdc` |
| **Windsurf** | ✅ Full | `.windsurfrules` |
| **GitHub Copilot** | ✅ Full | `.github/copilot-instructions.md` |
| **Continue** | ⚠️ Partiel | Garde config existante |
| **Cody** | ✅ Via AGENTS.md | `AGENTS.md` racine |

## 💡 Best Practices

### Commit uniquement .ai/

```bash
# ✅ À committer
.ai/

# ❌ Généré (gitignored)
AGENTS.md
.cursor/
.claude/
.github/copilot-instructions.md
```

### Garder les fichiers courts

- Chaque fichier `.ai/*.md` < 500 lignes
- Séparer les concerns
- Lier vers docs externes si besoin

### Synchroniser après pull

```bash
git pull

# Claude : Rien à faire (symlinks dynamiques)
# Cursor/Windsurf/Copilot : Régénérer si contexte modifié
bash templates/ides/cursor/init.sh
```

### Directives impératives

```markdown
# ✅ Bon
Utilisez TypeScript strict mode

# ❌ À éviter
Nous préférons utiliser TypeScript strict mode
```

Les IA répondent mieux aux instructions directes.

## 🐛 Troubleshooting

### L'IA ne suit pas les directives

1. **Claude** : Vérifiez les symlinks (`ls -la .claude/commands/`)
2. **Cursor/Windsurf/Copilot** : Régénérez (`bash templates/ides/<tool>/init.sh`)
3. Référencez explicitement : `@.ai/context/standards/typescript.md`
4. Redémarrez votre outil IA

### Les symlinks ne fonctionnent pas (Windows)

**Solution** : Utiliser Cursor, Windsurf ou Copilot (pas de symlinks)

Pour Claude sur Windows :
1. Activer le mode développeur Windows
2. Ou modifier `templates/ides/claude/init.sh` :
   ```bash
   # Remplacer ln -sf par cp
   cp -r .ai/commands/* .claude/commands/
   ```

### Conflit entre outils

- `.ai/` est la source de vérité unique
- Régénérez avec `bash templates/ides/<tool>/init.sh`
- Ne modifiez JAMAIS les fichiers générés (`.claude/`, `.cursor/`, etc.)

## 📚 Ressources

- [Documentation complète](https://github.com/betagouv/ai-cli/docs)
- [Exemples de projets](https://github.com/betagouv/ai-cli/examples)
- [Templates personnalisés](https://github.com/betagouv/ai-cli/templates)

## 🤝 Contribution

Contributions bienvenues ! Voir [CONTRIBUTING.md](CONTRIBUTING.md).

### Proposer un template

Les équipes peuvent proposer leurs propres templates :

1. Fork le repo
2. Ajoutez votre template dans `templates/`
3. Documentez dans `templates/README.md`
4. Ouvrez une PR

## 📄 License

MIT © beta.gouv.fr

## 🙋 Support

- GitHub Issues : [betagouv/ai-cli/issues](https://github.com/betagouv/ai-cli/issues)
- Slack beta.gouv : `#incubateur-outils-dev`

---

Fait avec ❤️ pour la communauté beta.gouv.fr
